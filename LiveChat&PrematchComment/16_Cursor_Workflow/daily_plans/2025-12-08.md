# å·¥ä½œè¨ˆåŠƒ - 2025-12-08

**æ—¥æœŸ**: 2025-12-08  
**éšæ®µ**: Repository Layer å¯¦ä½œ  
**é‡é»**: å®Œæˆ Repository Layer çš„æ‰€æœ‰å¯¦ä½œ

---

## ğŸ¯ ä»Šæ—¥ç›®æ¨™

### ä¸»è¦ä»»å‹™

#### 1. TDD-030: PrematchCommentRepository

**ç›®çš„**: å¯¦ä½œ PrematchComment çš„ Repository Layer

**å·¥ä½œå…§å®¹**:
- [ ] Repository Protocol å®šç¾©
- [ ] Repository Implementation å¯¦ä½œ
- [ ] DTO â†’ Domain Model è½‰æ›é‚è¼¯
- [ ] éŒ¯èª¤è™•ç†å’Œ Mapping
- [ ] Cursor åˆ†é è™•ç†

**é æœŸç”¢å‡º**:
- PrematchCommentRepository Protocol
- PrematchCommentRepository Implementation
- è½‰æ›é‚è¼¯æ¸¬è©¦ï¼ˆå¯é¸ï¼‰

#### 2. TDD-031: LiveChatRepository

**ç›®çš„**: å¯¦ä½œ LiveChat çš„ Repository Layer

**å·¥ä½œå…§å®¹**:
- [ ] Repository Protocol å®šç¾©
- [ ] Repository Implementation å¯¦ä½œ
- [ ] WebSocket æ•´åˆ
- [ ] èŠå¤©å®¤ç®¡ç†é‚è¼¯
- [ ] Message è½‰æ›é‚è¼¯

**é æœŸç”¢å‡º**:
- LiveChatRepository Protocol
- LiveChatRepository Implementation
- WebSocket æ•´åˆæ¸¬è©¦ï¼ˆå¯é¸ï¼‰

---

## ğŸ“ è©³ç´°ä»»å‹™æ¸…å–®

### Phase 1: TDD-030 å¯¦ä½œï¼ˆé è¨ˆ 3 å°æ™‚ï¼‰

#### 1.1 Protocol å®šç¾©ï¼ˆ30 åˆ†é˜ï¼‰

- [ ] å®šç¾© `PrematchCommentRepository` Protocol
- [ ] å®šç¾© Input/Output åƒæ•¸
- [ ] å®šç¾©éŒ¯èª¤é¡å‹

#### 1.2 Implementation å¯¦ä½œï¼ˆ1.5 å°æ™‚ï¼‰

- [ ] å‰µå»º Repository å¯¦ä½œ
- [ ] æ•´åˆ PrematchCommentClient
- [ ] å¯¦ä½œ DTO â†’ Domain Model è½‰æ›
- [ ] å¯¦ä½œ Cursor åˆ†é é‚è¼¯

#### 1.3 éŒ¯èª¤è™•ç†ï¼ˆ30 åˆ†é˜ï¼‰

- [ ] å®šç¾© Repository éŒ¯èª¤
- [ ] å¯¦ä½œéŒ¯èª¤ Mapping
- [ ] è™•ç†é‚Šç•Œæƒ…æ³

#### 1.4 æ¸¬è©¦ï¼ˆ30 åˆ†é˜ï¼Œå¯é¸ï¼‰

- [ ] å¯«åŸºæœ¬çš„ Unit Tests
- [ ] æ¸¬è©¦è½‰æ›é‚è¼¯
- [ ] æ¸¬è©¦éŒ¯èª¤è™•ç†

### Phase 2: TDD-031 å¯¦ä½œï¼ˆé è¨ˆ 3 å°æ™‚ï¼‰

#### 2.1 Protocol å®šç¾©ï¼ˆ30 åˆ†é˜ï¼‰

- [ ] å®šç¾© `LiveChatRepository` Protocol
- [ ] å®šç¾© Input/Output åƒæ•¸
- [ ] å®šç¾© WebSocket ç›¸é—œæ–¹æ³•

#### 2.2 Implementation å¯¦ä½œï¼ˆ1.5 å°æ™‚ï¼‰

- [ ] å‰µå»º Repository å¯¦ä½œ
- [ ] æ•´åˆ LiveChatClient
- [ ] æ•´åˆ ChatWebSocketClient
- [ ] å¯¦ä½œ Message è½‰æ›é‚è¼¯

#### 2.3 WebSocket æ•´åˆï¼ˆ30 åˆ†é˜ï¼‰

- [ ] å¯¦ä½œèŠå¤©å®¤è¨‚é–±
- [ ] å¯¦ä½œè¨Šæ¯æ¥æ”¶
- [ ] è™•ç†é€£ç·šç‹€æ…‹

#### 2.4 æ¸¬è©¦ï¼ˆ30 åˆ†é˜ï¼Œå¯é¸ï¼‰

- [ ] å¯«åŸºæœ¬çš„ Unit Tests
- [ ] æ¸¬è©¦ WebSocket æ•´åˆ
- [ ] æ¸¬è©¦è½‰æ›é‚è¼¯

### Phase 3: æ¶æ§‹è¨è«–èˆ‡æ–‡æª”æ›´æ–°ï¼ˆé è¨ˆ 1 å°æ™‚ï¼‰

#### 3.1 æ¶æ§‹è¨è«–ï¼ˆ30 åˆ†é˜ï¼‰

- [ ] è¨è«–å…©å±¤ Repository æ¶æ§‹
- [ ] è©•ä¼°å„ªç¼ºé»
- [ ] è¨˜éŒ„è¨­è¨ˆæ±ºç­–

#### 3.2 æ–‡æª”æ›´æ–°ï¼ˆ30 åˆ†é˜ï¼‰

- [ ] æ›´æ–° TDD-030 æ–‡æª”
- [ ] æ›´æ–° TDD-031 æ–‡æª”
- [ ] è¨˜éŒ„æ¶æ§‹æ±ºç­–

---

## ğŸ¤” é—œéµæ±ºç­–

### æ±ºç­– 1: å…©å±¤ Repository æ¶æ§‹

- **User Prompt**: "Repository Layer æ‡‰è©²è¿”å› DTO é‚„æ˜¯ Domain Modelï¼Ÿå¦‚æœè¿”å› Domain Modelï¼Œè½‰æ›é‚è¼¯æ‡‰è©²æ”¾åœ¨å“ªè£¡ï¼ŸClient é‚„æ˜¯ Repositoryï¼Ÿ"

- **èƒŒæ™¯**: Repository æ‡‰è©²è¿”å› DTO é‚„æ˜¯ Domain Modelï¼Ÿ

- **æ–¹æ¡ˆ**:
  1. å–®å±¤ Repositoryï¼ˆç›´æ¥è¿”å› Domain Modelï¼‰
  2. å…©å±¤ Repositoryï¼ˆAPI Repository è¿”å› DTOï¼ŒDomain Repository è¿”å› Domain Modelï¼‰

- **é¸æ“‡**: å…©å±¤ Repository

- **ç†ç”±**:
  - æ›´æ¸…æ™°çš„è·è²¬åˆ†é›¢
  - æ›´å®¹æ˜“æ¸¬è©¦
  - æ›´å¥½çš„é¡å‹å®‰å…¨
  - é™ä½ UseCase å±¤çš„è¤‡é›œåº¦

---

### æ±ºç­– 2: DTO è½‰æ›ä½ç½®

- **User Prompt**: "DTO åˆ° Domain Model çš„è½‰æ›é‚è¼¯æ‡‰è©²æ”¾åœ¨å“ªä¸€å±¤ï¼ŸClient Layerã€Repository Layer é‚„æ˜¯ UseCase Layerï¼Ÿ"

- **èƒŒæ™¯**: DTO â†’ Domain Model è½‰æ›æ‡‰è©²åœ¨å“ªè£¡ï¼Ÿ

- **æ–¹æ¡ˆ**:
  1. Client Layerï¼ˆClient ç›´æ¥è¿”å› Domain Modelï¼‰
  2. Repository Layerï¼ˆRepository è² è²¬è½‰æ›ï¼‰
  3. UseCase Layerï¼ˆUseCase è² è²¬è½‰æ›ï¼‰

- **é¸æ“‡**: Repository Layer

- **ç†ç”±**:
  - Repository æ˜¯ Domain å±¤å’Œ Data å±¤çš„æ©‹æ¨‘
  - è½‰æ›é‚è¼¯æ‡‰è©²é›†ä¸­ç®¡ç†
  - UseCase åªé—œå¿ƒ Domain Model
  - ç¬¦åˆ Clean Architecture åŸå‰‡

---

## ğŸš§ é æœŸå•é¡Œ

### å•é¡Œ 1: Cursor åˆ†é é‚è¼¯

- **User Prompt**: "PrematchComment API ä½¿ç”¨ Cursor-based åˆ†é ï¼ŒRepository æ‡‰è©²å¦‚ä½•è™•ç† cursor åƒæ•¸å’Œè¿”å›å€¼ï¼Ÿ"

- **æè¿°**: å¦‚ä½•è™•ç† Cursor-based åˆ†é ï¼Ÿ

- **è§£æ±ºæ–¹æ¡ˆ**:
  - Repository æ¥æ”¶ cursor åƒæ•¸ï¼ˆOptionalï¼‰
  - è¿”å› CommentListï¼ˆåŒ…å« comments å’Œ nextCursorï¼‰
  - UseCase ç®¡ç†åˆ†é ç‹€æ…‹

---

### å•é¡Œ 2: WebSocket ç”Ÿå‘½é€±æœŸ

- **User Prompt**: "LiveChat ä½¿ç”¨ WebSocket æ¥æ”¶å³æ™‚è¨Šæ¯ï¼ŒRepository æ‡‰è©²å¦‚ä½•ç®¡ç† WebSocket çš„é€£ç·šå’Œè¨‚é–±ï¼Ÿ"

- **æè¿°**: Repository å¦‚ä½•ç®¡ç† WebSocket é€£ç·šï¼Ÿ

- **è§£æ±ºæ–¹æ¡ˆ**:
  - Repository æä¾›è¨‚é–±/å–æ¶ˆè¨‚é–±æ–¹æ³•
  - WebSocket é€£ç·šç”± Client ç®¡ç†
  - Repository åªè² è²¬è¨‚é–±å’Œæ¥æ”¶è¨Šæ¯
  - ä½¿ç”¨ AsyncStream æä¾›è¨Šæ¯æµ

---

### å•é¡Œ 3: éŒ¯èª¤è™•ç†

- **User Prompt**: "Client Layer å¯èƒ½æ‹‹å‡ºå¤šç¨®éŒ¯èª¤ï¼ˆç¶²è·¯éŒ¯èª¤ã€è§£ç¢¼éŒ¯èª¤ç­‰ï¼‰ï¼ŒRepository æ‡‰è©²å¦‚ä½•çµ±ä¸€è™•ç†é€™äº›éŒ¯èª¤ï¼Ÿ"

- **æè¿°**: å¦‚ä½•çµ±ä¸€è™•ç†å„ç¨®éŒ¯èª¤ï¼Ÿ

- **è§£æ±ºæ–¹æ¡ˆ**:
  - å®šç¾© Repository éŒ¯èª¤é¡å‹
  - å°‡ Client éŒ¯èª¤ Mapping åˆ° Repository éŒ¯èª¤
  - æä¾›æ¸…æ™°çš„éŒ¯èª¤è¨Šæ¯
  - ä¿ç•™åŸå§‹éŒ¯èª¤è³‡è¨Šä¾›é™¤éŒ¯ä½¿ç”¨

---

## ğŸ“Š ä»»å‹™ç‹€æ…‹

### å·²å®Œæˆ

- âœ… TDD-020: PrematchCommentClient
- âœ… TDD-021: LiveChatClient
- âœ… TDD-022: ChatWebSocketClient

### é€²è¡Œä¸­

- ğŸ”„ TDD-030: PrematchCommentRepository
- ğŸ”„ TDD-031: LiveChatRepository

### å¾…è™•ç†

- â¸ï¸ TDD-040: ReloadCommentListUseCase
- â¸ï¸ TDD-041: PublishCommentUseCase

---

## ğŸ”„ æ˜æ—¥é‡é»

### ä¸»è¦ç›®æ¨™

1. **TDD ä¸€è‡´æ€§æª¢æŸ¥**
   - æª¢æŸ¥ APIã€Clientã€Repository å±¤
   - ç”Ÿæˆæª¢æŸ¥å ±å‘Š

2. **é–‹å§‹è¦åŠƒ UseCase Layer**
   - æº–å‚™ TDD-040 å¯¦ä½œ
   - å®šç¾© Input/Output Models

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

- [ ] TDD-030 Protocol å’Œ Implementation å®Œæˆ
- [ ] TDD-031 Protocol å’Œ Implementation å®Œæˆ
- [ ] å…©å±¤ Repository æ¶æ§‹æ±ºç­–è¨˜éŒ„
- [ ] åŸºæœ¬æ¸¬è©¦å®Œæˆï¼ˆå¯é¸ï¼‰
- [ ] æ‰€æœ‰ commits æäº¤

---

## ç›¸é—œæ–‡ä»¶

- [å·¥ä½œæ—¥èªŒ - 2025-12-08](../../15_Daily_Logs/2025-12-08.md)
- [TDD-030: PrematchCommentRepository](../../12_Tickets/04_repository/TDD-030_PrematchCommentRepository.md)
- [TDD-031: LiveChatRepository](../../12_Tickets/04_repository/TDD-031_LiveChatRepository.md)

