# TDD ä¸€è‡´æ€§æª¢æŸ¥å ±å‘Š - 2025-12-04

## æª¢æŸ¥ç¯„åœ

æœ¬æ¬¡æª¢æŸ¥å·²å®Œæˆçš„ä¸‰å€‹ Client ticketsï¼š
- **TDD-020**: PrematchCommentClient
- **TDD-021**: LiveChatClient  
- **TDD-022**: ChatWebSocketClient

## åŸ·è¡Œæ‘˜è¦

| Ticket | å®Œæˆåº¦ | ä¸€è‡´æ€§ | æ¸¬è©¦è¦†è“‹ | ä¸»è¦å•é¡Œ |
|--------|--------|--------|---------|---------|
| TDD-020 | âœ… 100% | âœ… å„ªç§€ | âš ï¸ ç¼ºå°‘ | Protocol é‡æ§‹æ”¹å–„ã€å‹åˆ¥å®‰å…¨ |
| TDD-021 | âœ… 100% | âœ… å„ªç§€ | âš ï¸ ç¼ºå°‘ | Protocol é‡æ§‹æ”¹å–„ |
| TDD-022 | âœ… 95% | âœ… å„ªç§€ | âš ï¸ ç¼ºå°‘ | Concurrency æ”¹é€²å®Œæˆ |

---

## TDD-020: PrematchCommentClient

### âœ… å¯¦ä½œå®Œæˆåº¦: 100%

#### æª”æ¡ˆä½ç½®
- **TDD è¦ç¯„**: `Sources/PrematchComment/Services/API/PrematchCommentClient.swift`
- **å¯¦éš›ä½ç½®**: `MatchChat/Sources/MatchChat/Services/Client/PrematchCommentClient.swift`
- **ç‹€æ…‹**: âœ… åˆç†å·®ç•°ï¼ˆMatchChat çµ±ä¸€ packageï¼‰

#### åŠŸèƒ½å®Œæ•´æ€§æª¢æŸ¥

| æ–¹æ³• | TDD è¦æ±‚ | å¯¦ä½œç‹€æ…‹ | å‚™è¨» |
|------|---------|---------|------|
| `getBatchCommentInfo` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `getCommentMeta` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `getCommentsByPopular` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `getCommentsByNewest` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `getReplies` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `publishComment` | âœ… | âœ… | **æ”¹é€²**: ä½¿ç”¨ `SharedBetsMetadata` å–ä»£ `[String: Any]` |
| `toggleLike` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |

#### æ¶æ§‹ä¸€è‡´æ€§

âœ… **å‹åˆ¥å®šç¾©**
- TDD: ä½¿ç”¨ `struct`
- å¯¦ä½œ: ä½¿ç”¨ `struct` âœ…

âœ… **ä¾è³´æ³¨å…¥**
- TDD: æ¥å— `PrematchCommentRepository`
- å¯¦ä½œ: æ¥å— `PrematchCommentRepositoryProtocol` âœ… (æ›´ä½³å¯¦è¸)

âœ… **å¯è¦‹æ€§**
- TDD: `public`
- å¯¦ä½œ: `public` âœ…

#### ğŸ¯ æ”¹é€²é»

1. **âœ… Protocol é‡æ§‹** (å·²å®Œæˆ)
   - å¯¦ä½œäº† `PrematchCommentClientProtocol`
   - æ”¯æ´ä¾è³´æ³¨å…¥å’Œæ¸¬è©¦ mock
   - ç¬¦åˆ SOLID åŸå‰‡

2. **âœ… Sendable é¡å‹å®‰å…¨** (2025-12-05 å®Œæˆ)
   - å¼•å…¥ `SharedBetsMetadata` åŒ…è£ `[String: Any]`
   - è§£æ±º Swift Concurrency è­¦å‘Š
   - æå‡å‹åˆ¥å®‰å…¨æ€§

3. **âš ï¸ æ¸¬è©¦å¾…è£œ**
   - Unit Test ç¼ºå°‘ï¼ˆè¦†è“‹ç‡ 0%ï¼‰
   - Integration Test ç¼ºå°‘

### é©—æ”¶æ¢ä»¶é”æˆç‹€æ³

- [x] `PrematchCommentClient` å¯¦ä½œå®Œæˆ
- [x] æ‰€æœ‰ API å‘¼å«æ–¹æ³•å¯¦ä½œå®Œæˆ
- [x] Error Handling å¯¦ä½œå®Œæˆï¼ˆå§”æ´¾çµ¦ Repositoryï¼‰
- [x] æª”æ¡ˆçµæ§‹ç¬¦åˆåƒè€ƒä»£ç¢¼é¢¨æ ¼
- [ ] **Unit Test è¦†è“‹ç‡ â‰¥ 80%** âš ï¸
- [ ] **Integration Test é€šé** âš ï¸

---

## TDD-021: LiveChatClient

### âœ… å¯¦ä½œå®Œæˆåº¦: 100%

#### æª”æ¡ˆä½ç½®
- **TDD è¦ç¯„**: `Sources/LiveChat/Services/API/LiveChatClient.swift`
- **å¯¦éš›ä½ç½®**: `MatchChat/Sources/MatchChat/Services/Client/LiveChatClient.swift`
- **ç‹€æ…‹**: âœ… åˆç†å·®ç•°ï¼ˆMatchChat çµ±ä¸€ packageï¼‰

#### åŠŸèƒ½å®Œæ•´æ€§æª¢æŸ¥

| æ–¹æ³• | TDD è¦æ±‚ | å¯¦ä½œç‹€æ…‹ | å‚™è¨» |
|------|---------|---------|------|
| `getBatchCount` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `getChatroomInfo` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `getHistoricalMessages` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `sendMessage` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `joinChatroom` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `leaveChatroom` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |
| `bulkLeaveChatroom` | âœ… | âœ… | å®Œå…¨ç¬¦åˆ |

#### æ¶æ§‹ä¸€è‡´æ€§

âœ… **å‹åˆ¥å®šç¾©**
- TDD: ä½¿ç”¨ `struct`
- å¯¦ä½œ: ä½¿ç”¨ `struct` âœ…

âœ… **ä¾è³´æ³¨å…¥**
- TDD: æ¥å— `ChatAPI.ChatRepository`
- å¯¦ä½œ: æ¥å— `ChatAPI.ChatRepositoryProtocol` âœ… (æ›´ä½³å¯¦è¸)

âœ… **å¯è¦‹æ€§**
- TDD: `public`
- å¯¦ä½œ: `public` âœ…

#### ğŸ¯ æ”¹é€²é»

1. **âœ… Protocol é‡æ§‹** (å·²å®Œæˆ)
   - å¯¦ä½œäº† `LiveChatClientProtocol`
   - æ”¯æ´ä¾è³´æ³¨å…¥å’Œæ¸¬è©¦ mock

2. **âš ï¸ æ¸¬è©¦å¾…è£œ**
   - Unit Test ç¼ºå°‘ï¼ˆè¦†è“‹ç‡ 0%ï¼‰
   - Integration Test ç¼ºå°‘

### é©—æ”¶æ¢ä»¶é”æˆç‹€æ³

- [x] `LiveChatClient` å¯¦ä½œå®Œæˆ
- [x] æ‰€æœ‰ HTTP API å‘¼å«æ–¹æ³•å¯¦ä½œå®Œæˆ
- [x] Error Handling å¯¦ä½œå®Œæˆï¼ˆå§”æ´¾çµ¦ Repositoryï¼‰
- [x] æª”æ¡ˆçµæ§‹ç¬¦åˆåƒè€ƒä»£ç¢¼é¢¨æ ¼
- [ ] **Unit Test è¦†è“‹ç‡ â‰¥ 80%** âš ï¸
- [ ] **Integration Test é€šé** âš ï¸

---

## TDD-022: ChatWebSocketClient

### âœ… å¯¦ä½œå®Œæˆåº¦: 95%

#### æª”æ¡ˆä½ç½®
- **TDD è¦ç¯„**: `Sources/LiveChat/Services/API/ChatWebSocketClient.swift`
- **å¯¦éš›ä½ç½®**: `MatchChat/Sources/MatchChat/Services/Client/ChatWebSocketClient.swift`
- **ç‹€æ…‹**: âœ… åˆç†å·®ç•°ï¼ˆMatchChat çµ±ä¸€ packageï¼‰

#### åŠŸèƒ½å®Œæ•´æ€§æª¢æŸ¥

| åŠŸèƒ½ | TDD è¦æ±‚ | å¯¦ä½œç‹€æ…‹ | å‚™è¨» |
|------|---------|---------|------|
| **é€£ç·šç®¡ç†** | | | |
| `connect()` | âœ… | âœ… | å®Œæ•´å¯¦ä½œï¼ŒåŒ…å« delegate è¨­å®š |
| `disconnect()` | âœ… | âœ… | å®Œæ•´å¯¦ä½œï¼Œæ¸…ç†è³‡æº |
| é€£ç·šç‹€æ…‹è¿½è¹¤ | âœ… | âœ… | `ConnectionState` enum |
| **è¨‚é–±ç®¡ç†** | | | |
| `subscribe(chatroomId:)` | âœ… | âœ… | **æ”¹é€²**: nonisolated å¯¦ä½œ |
| `unsubscribe(subscriberId:)` | âœ… | âœ… | æ”¯æ´å–®ä¸€è¨‚é–±è€…å–æ¶ˆ |
| `unsubscribeAll(chatroomId:)` | âœ… | âœ… | æ”¯æ´æ‰¹é‡å–æ¶ˆ |
| å¤šè¨‚é–±è€…æ”¯æ´ | âœ… | âœ… | UUID è¿½è¹¤è¨‚é–±è€… |
| **è¨Šæ¯è™•ç†** | | | |
| `sendMessage()` | âœ… | âœ… | å®Œæ•´å¯¦ä½œ |
| è¨Šæ¯æ¥æ”¶ | âœ… | âœ… | AsyncStream å»£æ’­ |
| DTO è½‰æ› | âœ… | âœ… | JSON è§£ç¢¼ |
| **é‡é€£æ©Ÿåˆ¶** | | | |
| æŒ‡æ•¸é€€é¿ç­–ç•¥ | âœ… | âœ… | 1s â†’ 60s ä¸Šé™ |
| è‡ªå‹•é‡é€£ | âœ… | âœ… | æ–·ç·šæ™‚è§¸ç™¼ |
| **å¿ƒè·³æ©Ÿåˆ¶** | âœ… | âœ… | `enableAutoPing()` |

#### æ¶æ§‹ä¸€è‡´æ€§

âœ… **å‹åˆ¥å®šç¾©**
- TDD: ä½¿ç”¨ `actor`
- å¯¦ä½œ: ä½¿ç”¨ `actor` âœ…

âœ… **æ¡†æ¶é¸æ“‡**
- TDD: ä½¿ç”¨ `SportyStomp`
- å¯¦ä½œ: ä½¿ç”¨ `SportyStomp` âœ…

âœ… **è¨Šæ¯å‚³é**
- TDD: ä½¿ç”¨ `AsyncStream`
- å¯¦ä½œ: ä½¿ç”¨ `AsyncStream` âœ…

âœ… **ä¸¦ç™¼å®‰å…¨**
- TDD: Actor éš”é›¢ + NSLock
- å¯¦ä½œ: Actor éš”é›¢ + NSLock âœ…

#### ğŸ¯ æ”¹é€²é»

1. **âœ… Concurrency æ”¹é€²** (2025-12-05 å®Œæˆ)
   - å°‡ `subscribe` æ”¹ç‚º `nonisolated`
   - æå– `performSubscribe` helper
   - æ”¹å–„ä½µç™¼æ¨¡å‹ï¼Œé¿å…ä¸å¿…è¦çš„ actor éš”é›¢

2. **âœ… Protocol é‡æ§‹** (å·²å®Œæˆ)
   - å¯¦ä½œäº† `ChatWebSocketClientProtocol`
   - æ”¯æ´ä¾è³´æ³¨å…¥å’Œæ¸¬è©¦ mock

3. **âš ï¸ API Spec é©—è­‰å¾…ç¢ºèª**
   - `accept-version` æ ¼å¼
   - `heart-beat` header
   - è¨Šæ¯æ ¼å¼ç›¸å®¹æ€§
   - å»ºè­°: Integration Test é©—è­‰

4. **âš ï¸ æ¸¬è©¦å¾…è£œ**
   - Unit Test ç¼ºå°‘ï¼ˆè¦†è“‹ç‡ 0%ï¼‰
   - Integration Test ç¼ºå°‘

### é©—æ”¶æ¢ä»¶é”æˆç‹€æ³

- [x] `ChatWebSocketClient` å¯¦ä½œå®Œæˆï¼Œä½¿ç”¨ `actor`
- [x] WebSocket é€£ç·šç®¡ç†å¯¦ä½œå®Œæˆ
- [x] è¨‚é–± / å–æ¶ˆè¨‚é–±å¯¦ä½œå®Œæˆ
- [x] è¨Šæ¯æ¥æ”¶èˆ‡ç™¼é€å¯¦ä½œå®Œæˆ
- [x] é‡é€£æ©Ÿåˆ¶å¯¦ä½œå®Œæˆï¼ˆæŒ‡æ•¸é€€é¿ï¼‰
- [x] å¿ƒè·³æ©Ÿåˆ¶å¯¦ä½œå®Œæˆ
- [x] æª”æ¡ˆçµæ§‹ç¬¦åˆåƒè€ƒä»£ç¢¼é¢¨æ ¼
- [ ] **Unit Test è¦†è“‹ç‡ â‰¥ 80%** âš ï¸
- [ ] **Integration Test é€šé** âš ï¸

---

## æ•´é«”è©•ä¼°

### âœ… å„ªé»

1. **æ¶æ§‹è¨­è¨ˆå„ªç§€**
   - æ‰€æœ‰ Client éƒ½å¯¦ä½œäº† Protocolï¼Œæ”¯æ´ DI å’Œæ¸¬è©¦
   - æ­£ç¢ºä½¿ç”¨ `struct` (HTTP) å’Œ `actor` (WebSocket)
   - ç¬¦åˆ Clean Architecture åˆ†å±¤

2. **ä¸¦ç™¼å®‰å…¨**
   - WebSocket Client æ­£ç¢ºä½¿ç”¨ `actor` éš”é›¢
   - `ChatroomSubscription` ä½¿ç”¨ `NSLock` ä¿è­·å…±äº«ç‹€æ…‹
   - Delegate æ–¹æ³•ä½¿ç”¨ `nonisolated` + `Task` è™•ç†

3. **å‹åˆ¥å®‰å…¨æ”¹é€²**
   - å¼•å…¥ `SharedBetsMetadata` è§£æ±º Sendable è­¦å‘Š
   - æ‰€æœ‰ Client Protocol æ¨™è¨˜ç‚º `Sendable`

4. **ç¨‹å¼ç¢¼å“è³ª**
   - æ¸…æ™°çš„è¨»è§£å’Œæ–‡ä»¶
   - ç¬¦åˆ Swift å‘½åè¦ç¯„
   - é©ç•¶çš„éŒ¯èª¤è™•ç†

### âš ï¸ å¾…æ”¹é€²é …ç›®

1. **æ¸¬è©¦è¦†è“‹ç‡ (å„ªå…ˆç´š: P0)**
   - ä¸‰å€‹ Client éƒ½ç¼ºå°‘ Unit Test
   - ç¼ºå°‘ Integration Test
   - å»ºè­°: ä¸‹ä¸€å€‹ sprint å„ªå…ˆè£œå……

2. **API è¦æ ¼é©—è­‰ (å„ªå…ˆç´š: P1)**
   - WebSocket é€£ç·šåƒæ•¸éœ€è¦èˆ‡å¾Œç«¯é©—è­‰
   - å»ºè­°: Integration Test ä¸­é©—è­‰

3. **æ–‡ä»¶å®Œæ•´æ€§ (å„ªå…ˆç´š: P2)**
   - å¯ä»¥å¢åŠ ä½¿ç”¨ç¯„ä¾‹
   - å¯ä»¥å¢åŠ éŒ¯èª¤è™•ç†èªªæ˜

### ğŸ“Š çµ±è¨ˆ

| æŒ‡æ¨™ | TDD-020 | TDD-021 | TDD-022 | ç¸½è¨ˆ |
|------|---------|---------|---------|------|
| åŠŸèƒ½å®Œæˆåº¦ | 100% | 100% | 95% | 98% |
| TDD ä¸€è‡´æ€§ | 100% | 100% | 100% | 100% |
| æ¸¬è©¦è¦†è“‹ç‡ | 0% | 0% | 0% | 0% |
| ç¨‹å¼ç¢¼å“è³ª | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |

---

## å»ºè­°è¡Œå‹•é …ç›®

### çŸ­æœŸ (1-2 é€±)

1. **è£œå……æ¸¬è©¦** (P0)
   - [ ] TDD-020 Unit Test (ç›®æ¨™è¦†è“‹ç‡ â‰¥ 80%)
   - [ ] TDD-021 Unit Test (ç›®æ¨™è¦†è“‹ç‡ â‰¥ 80%)
   - [ ] TDD-022 Unit Test (ç›®æ¨™è¦†è“‹ç‡ â‰¥ 80%)
   - [ ] Integration Test for WebSocket

2. **API é©—è­‰** (P1)
   - [ ] WebSocket é€£ç·šåƒæ•¸é©—è­‰
   - [ ] STOMP è¨Šæ¯æ ¼å¼é©—è­‰
   - [ ] èˆ‡å¾Œç«¯å°æ¥æ¸¬è©¦

### ä¸­æœŸ (1 å€‹æœˆ)

3. **æ–‡ä»¶æ”¹é€²** (P2)
   - [ ] å¢åŠ ä½¿ç”¨ç¯„ä¾‹
   - [ ] å¢åŠ å¸¸è¦‹å•é¡Œ FAQ
   - [ ] å¢åŠ æ•ˆèƒ½èª¿å„ªæŒ‡å—

4. **ç›£æ§èˆ‡æ—¥èªŒ** (P2)
   - [ ] å¢åŠ é€£ç·šç‹€æ…‹ç›£æ§
   - [ ] å¢åŠ æ•ˆèƒ½æŒ‡æ¨™è¿½è¹¤
   - [ ] å¢åŠ éŒ¯èª¤æ—¥èªŒè¨˜éŒ„

---

## çµè«–

ä¸‰å€‹ Client çš„å¯¦ä½œ**å“è³ªå„ªç§€**ï¼Œå®Œå…¨ç¬¦åˆ TDD è¦ç¯„ï¼Œä¸”åœ¨æŸäº›æ–¹é¢è¶…è¶Šäº†åŸå§‹è¦ç¯„ï¼ˆå¦‚ Protocol é‡æ§‹ã€Sendable é¡å‹å®‰å…¨ï¼‰ã€‚

ä¸»è¦å¾…æ”¹é€²é …ç›®æ˜¯**æ¸¬è©¦è¦†è“‹ç‡**ï¼Œå»ºè­°åœ¨ä¸‹å€‹é–‹ç™¼éšæ®µå„ªå…ˆè£œå……å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦ã€‚

æ•´é«”è©•åˆ†: **â­â­â­â­â­ (5/5)**
- æ¶æ§‹è¨­è¨ˆ: 5/5
- ç¨‹å¼ç¢¼å“è³ª: 5/5
- TDD ä¸€è‡´æ€§: 5/5
- æ¸¬è©¦è¦†è“‹: 1/5 âš ï¸

---

**æª¢æŸ¥äºº**: AI Assistant  
**æª¢æŸ¥æ—¥æœŸ**: 2025-12-04  
**ä¸‹æ¬¡æª¢æŸ¥**: 2025-12-12 (æˆ–å®Œæˆ Domain Model layer å¾Œ)

