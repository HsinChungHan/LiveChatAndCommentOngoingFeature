# Risks & Questions

## 技術風險

### 1. WebSocket 連線穩定性

**風險等級**：中

**描述**：
- WebSocket 連線可能因網路不穩定而中斷
- 需要實作完善的重連機制

**影響**：
- 用戶可能無法即時接收聊天訊息
- 影響用戶體驗

**緩解措施**：
- 實作指數退避重連策略
- 實作心跳機制檢測連線狀態
- 提供離線狀態提示

---

### 2. 黑名單清理邏輯

**風險等級**：低

**描述**：
- 黑名單 4 小時自動清理邏輯需要在用戶關閉聊天室時執行
- 如果用戶長時間不關閉聊天室，黑名單可能累積過多

**影響**：
- 可能影響效能
- 黑名單資料可能過期

**緩解措施**：
- 實作定期清理機制（即使聊天室未關閉）
- 限制黑名單最大數量

---

### 3. 歷史訊息與 WebSocket 訊息合併

**風險等級**：中

**描述**：
- 需要將歷史訊息與 WebSocket 訊息合併並去重
- 如果訊息順序不正確，可能導致顯示錯誤

**影響**：
- 訊息顯示順序可能錯誤
- 可能出現重複訊息

**緩解措施**：
- 使用 `messageNo` 進行排序和去重
- 實作完善的合併邏輯測試

---

## 業務風險

### 1. 個人資訊 API 待定

**風險等級**：高

**描述**：
- 個人資訊 API（`GET /{TBD 個人資訊 API}`）目前為待定狀態
- 需要與後端團隊確認實際 API

**影響**：
- 可能影響開發時程
- 需要調整實作方式

**緩解措施**：
- 盡快與後端團隊確認 API 規格
- 先使用 Mock API 進行開發

---

### 2. 外部 Package 依賴

**風險等級**：中

**描述**：
- 依賴多個外部 Package（PersonalPage、FComSharedFlow、FactsCenter）
- 外部 Package 的變更可能影響本功能

**影響**：
- 外部 Package 更新可能導致功能異常
- 需要協調多個團隊

**緩解措施**：
- 使用 Adapter Pattern 解耦
- 定義清晰的 Protocol 介面
- 定期與相關團隊溝通

---

## 待確認問題

### 1. 個人資訊 API 規格

**問題**：個人資訊 API 的實際 endpoint 和 response 格式為何？

**狀態**：待確認

**負責人**：需與 Eason 或 Han 確認

**影響**：影響 `getUserInfo()` 方法的實作

---

### 2. Event Status 通知機制

**問題**：FactsCenter Package 的 Event Status 通知機制是否穩定？

**狀態**：待確認

**負責人**：需與 FactsCenter Package 團隊確認

**影響**：影響 Prematch Comment Page 的自動關閉邏輯

---

### 3. Nickname 建立流程

**問題**：FComSharedFlow Package 的 Nickname 建立流程是否會阻塞 UI？

**狀態**：待確認

**負責人**：需與 FComSharedFlow Package 團隊確認

**影響**：影響用戶發送留言的體驗

---

### 4. 黑名單同步機制

**問題**：WebSocket 重連後，blocked user 清單的同步機制為何？

**狀態**：待確認

**負責人**：需與後端團隊確認

**影響**：影響封鎖功能的實作

---

## 依賴風險

### 1. 後端 API 開發進度

**風險等級**：中

**描述**：
- 依賴後端 API 的開發進度
- 如果後端 API 延遲，可能影響前端開發

**影響**：
- 可能影響開發時程
- 需要調整開發順序

**緩解措施**：
- 使用 Mock API 進行並行開發
- 定期與後端團隊同步進度

---

### 2. 外部 Package 版本相容性

**風險等級**：低

**描述**：
- 外部 Package 的版本更新可能導致相容性問題

**影響**：
- 可能需要調整實作方式
- 可能影響功能穩定性

**緩解措施**：
- 鎖定外部 Package 版本
- 定期測試相容性

---

## 時程風險

### 1. 複雜功能開發時間

**風險等級**：中

**描述**：
- WebSocket 連線管理和訊息合併邏輯較複雜
- 可能超出預估開發時間

**影響**：
- 可能影響專案時程

**緩解措施**：
- 提前進行技術驗證（POC）
- 預留緩衝時間

---

### 2. 測試時間不足

**風險等級**：低

**描述**：
- 功能較複雜，測試場景較多
- 可能測試時間不足

**影響**：
- 可能影響品質

**緩解措施**：
- 提前準備測試案例
- 自動化測試覆蓋關鍵流程

---

## 風險追蹤

| 風險 | 等級 | 狀態 | 負責人 | 預計解決時間 |
|------|------|------|--------|------------|
| 個人資訊 API 待定 | 高 | 待確認 | - | - |
| WebSocket 連線穩定性 | 中 | 已識別 | 開發團隊 | 開發階段 |
| 外部 Package 依賴 | 中 | 已識別 | 開發團隊 | 持續追蹤 |
| 歷史訊息合併邏輯 | 中 | 已識別 | 開發團隊 | 開發階段 |

