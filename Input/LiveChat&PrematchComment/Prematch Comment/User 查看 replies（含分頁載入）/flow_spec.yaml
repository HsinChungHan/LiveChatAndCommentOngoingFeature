features:
  PrematchComment:
    flows:
      - flow_id: PC-SUB-003
        flow_type: Sub
        flow_name: 用戶查看 replies（含分頁載入）
        parent_flow_id: PC-FULL-001
        parent_flow_name: 用戶進入 Upcoming Race Page, Prematch Comment Page 與 Top
        original_annotation: "@flow: Sub"
        mermaid_code: |
          ```mermaid
          sequenceDiagram
            autonumber
            actor User
            participant App
            participant Server as Server

            User->>App: 點擊 12 replies
            loop 每次最多 5 筆
              App->>Server: GET /chat/match/comment/replies
              Server-->>App: replies[<=5], nextCursor?
              alt 有超過5筆
                App-->>User: 顯示 Show more replies
                User->>App: 點擊 Show more replies
              else 不足5筆
                App-->>User: 隱藏 Show more replies
              end
            end
          ```
        description: |
          # 用戶查看 replies（含分頁載入）流程說明

          ## 流程概述

          本流程為子流程（Sub Flow），主流程為：**用戶進入 Upcoming Race Page, Prematch Comment Page 與 Top**（flow_id: PC-FULL-001）。

          本文件描述用戶查看留言回覆的完整流程，包括點擊回覆數量、分頁載入回覆列表以及顯示「Show more replies」按鈕等功能。本流程涉及以下參與者：**User（用戶）**、**App（應用程式）** 和 **Server（伺服器）**。

          ---

          ## 1. 點擊回覆數量

          當用戶點擊留言的回覆數量（例如「12 replies」）時，應用程式會開始載入回覆列表。

          - **用戶操作**：點擊 12 replies
          - **應用程式行為**：開始載入回覆列表

          ---

          ## 2. 分頁載入回覆

          應用程式會以分頁方式載入回覆，每次最多載入 5 筆回覆。

          - **循環條件**：每次最多 5 筆
          - **應用程式行為**：向伺服器發送 `GET /chat/match/comment/replies` 請求
          - **伺服器回應**：回傳 `replies[<=5]`（最多 5 筆回覆）和 `nextCursor?`（下一頁游標，可選）

          ---

          ## 3. 顯示「Show more replies」按鈕

          根據回覆數量，應用程式會決定是否顯示「Show more replies」按鈕。

          ### 情境 A：有超過 5 筆回覆
          - **應用程式行為**：顯示「Show more replies」按鈕
          - **用戶操作**：點擊「Show more replies」
          - **應用程式行為**：載入下一批回覆（繼續循環）

          ### 情境 B：不足 5 筆回覆
          - **應用程式行為**：隱藏「Show more replies」按鈕
          - **循環結束**：所有回覆已載入完成

          ---

          ## 技術備註

          1. **分頁載入**：每次最多載入 5 筆回覆，避免一次載入過多資料
          2. **游標機制**：使用 `nextCursor` 來追蹤下一頁的位置
          3. **動態按鈕**：根據回覆數量動態顯示或隱藏「Show more replies」按鈕
          4. **循環載入**：用戶可以持續點擊「Show more replies」來載入更多回覆，直到所有回覆載入完成
        api_endpoints:
          - path: GET /chat/match/comment/replies
            method: GET
            description: 取得留言回覆列表
            parameters:
              - commentId: 留言 ID（從 context 取得）
              - cursor: 分頁游標（可選）
            response:
              replies: 回覆列表（最多 5 筆）
              nextCursor: 下一頁游標（可選）
        notes:
          - 每次最多載入 5 筆回覆，避免一次載入過多資料
          - 使用 nextCursor 來追蹤下一頁的位置
          - 根據回覆數量動態顯示或隱藏「Show more replies」按鈕
          - 用戶可以持續點擊「Show more replies」來載入更多回覆，直到所有回覆載入完成
        scenarios:
          - name: 有超過 5 筆回覆
            description: 當回覆數量超過 5 筆時的行為
            condition: 回覆數量 > 5 筆
            actions:
              - 顯示「Show more replies」按鈕
              - 用戶點擊後載入下一批回覆
          - name: 不足 5 筆回覆
            description: 當回覆數量不足 5 筆時的行為
            condition: 回覆數量 <= 5 筆
            actions:
              - 隱藏「Show more replies」按鈕
              - 循環結束
        user_actions:
          - action: 點擊 12 replies
            description: 用戶點擊留言的回覆數量
            triggers:
              - 開始載入回覆列表
          - action: 點擊 Show more replies
            description: 用戶點擊「Show more replies」按鈕載入更多回覆
            preconditions:
              - 有超過 5 筆回覆
            triggers:
              - 載入下一批回覆
        system_behaviors:
          - behavior: 載入回覆列表
            description: 應用程式以分頁方式載入回覆列表
            api: GET /chat/match/comment/replies
            pagination:
              - 每次最多 5 筆
              - 使用 nextCursor 追蹤下一頁
          - behavior: 顯示「Show more replies」按鈕
            description: 應用程式根據回覆數量顯示或隱藏「Show more replies」按鈕
            condition: 有超過 5 筆回覆時顯示
          - behavior: 隱藏「Show more replies」按鈕
            description: 應用程式隱藏「Show more replies」按鈕
            condition: 不足 5 筆回覆時隱藏

